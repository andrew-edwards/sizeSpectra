<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Andrew Edwards" />


<title>MEPS_IBTS_1</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">MEPS_IBTS_1</h1>
<h4 class="author">Andrew Edwards</h4>



<div id="pre-processing-of-ibts-data-to-get-desired-data-for-meps-table-1" class="section level2">
<h2>Pre-processing of IBTS data to get desired data for MEPS Table 1</h2>
<p>These are the steps for pre-processing the IBTS data to retain just the desired elements for the analyses in the MEPS paper. Should be useful for repeating the analyses with updated data (if so it would be good to use the <code>icesDATRAS</code> package to automate the downloading of the data). This may also be useful for anyone wanting to extract data and do similar analyses. This is not functionalised, but is better to work through the steps in an Rmarkdown-type format to understand and check what is going on.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(sizeSpectra)</a></code></pre></div>
<p>Data were extracted from the IBTS DATRAS website by Julia Blanchard who then undertook some initial processing, as detailed in Supplementary Material of MEPS paper, and also included with the species-specific length-weight parameters from Fung et al. (2012). The data are saved within this package as <code>dataOrig</code> (see data-raw/IBTS-data.R).</p>
<p>First, understand the data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">dim</span>(dataOrig)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; [1] 178435     13</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">names</span>(dataOrig)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt;  [1] &quot;AphiaID&quot;              &quot;Survey&quot;               &quot;Year&quot;                </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;  [4] &quot;Quarter&quot;              &quot;Area&quot;                 &quot;Species&quot;             </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;  [7] &quot;LngtClas&quot;             &quot;CPUE_number_per_hour&quot; &quot;Taxonomic.group&quot;     </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; [10] &quot;a&quot;                    &quot;b&quot;                    &quot;weight_g&quot;            </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; [13] &quot;CPUE_bio_per_hour&quot;</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">dataOrig[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; # A tibble: 5 x 7</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;   AphiaID Survey   Year Quarter  Area Species          LngtClas</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;     &lt;int&gt; &lt;fct&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;fct&gt;               &lt;int&gt;</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; 1  101170 NS-IBTS  2003       1     4 Myxine glutinosa      360</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; 2  101170 NS-IBTS  2008       1     2 Myxine glutinosa        0</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; 3  101170 NS-IBTS  2004       1     5 Myxine glutinosa        0</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; 4  101170 NS-IBTS  2004       1     1 Myxine glutinosa      330</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; 5  101170 NS-IBTS  2013       1     4 Myxine glutinosa      330</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">dataOrig[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">8</span><span class="op">:</span><span class="dv">13</span>]</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; # A tibble: 5 x 6</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt;   CPUE_number_per_hour Taxonomic.group       a     b weight_g CPUE_bio_per_hour</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt;                  &lt;dbl&gt; &lt;fct&gt;             &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;             &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; 1               0.0556 Myxine glutinosa 0.0033  2.70     52.4              2.91</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; 2               0      Myxine glutinosa 0.0033  2.70      0                0   </span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; 3               0      Myxine glutinosa 0.0033  2.70      0                0   </span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; 4               0.0244 Myxine glutinosa 0.0033  2.70     41.4              1.01</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; 5               0.0909 Myxine glutinosa 0.0033  2.70     41.4              3.76</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="kw">summary</span>(dataOrig)</a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#&gt;     AphiaID           Survey            Year         Quarter       Area      </span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co">#&gt;  Min.   :101170   NS-IBTS:178435   Min.   :1986   Min.   :1   Min.   :1.000  </span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co">#&gt;  1st Qu.:126436                    1st Qu.:1993   1st Qu.:1   1st Qu.:2.000  </span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="co">#&gt;  Median :126445                    Median :2001   Median :1   Median :4.000  </span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="co">#&gt;  Mean   :125728                    Mean   :2001   Mean   :1   Mean   :3.839  </span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co">#&gt;  3rd Qu.:127140                    3rd Qu.:2008   3rd Qu.:1   3rd Qu.:6.000  </span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">#&gt;  Max.   :274304                    Max.   :2015   Max.   :1   Max.   :7.000  </span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">#&gt;                                                                              </span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">#&gt;                      Species          LngtClas      CPUE_number_per_hour</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co">#&gt;  Gadus morhua            : 25832   Min.   :   0.0   Min.   :   0.000    </span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co">#&gt;  Amblyraja radiata       :  9316   1st Qu.: 120.0   1st Qu.:   0.040    </span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="co">#&gt;  Clupea harengus         :  8919   Median : 230.0   Median :   0.121    </span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="co">#&gt;  Merlangius merlangus    :  7676   Mean   : 271.3   Mean   :  11.972    </span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="co">#&gt;  Melanogrammus aeglefinus:  6527   3rd Qu.: 370.0   3rd Qu.:   0.717    </span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="co">#&gt;  Pleuronectes platessa   :  6403   Max.   :1500.0   Max.   :7207.821    </span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="co">#&gt;  (Other)                 :113762                                        </span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="co">#&gt;                  Taxonomic.group         a                  b        </span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"><span class="co">#&gt;  Gadus morhua            : 25832   Min.   :0.000100   Min.   :1.797  </span></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"><span class="co">#&gt;  Amblyraja radiata       :  9316   1st Qu.:0.003500   1st Qu.:3.079  </span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48"><span class="co">#&gt;  Conger conger           :  8919   Median :0.004200   Median :3.156  </span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="co">#&gt;  Merlangius merlangus    :  7676   Mean   :0.006864   Mean   :3.146  </span></a>
<a class="sourceLine" id="cb2-50" data-line-number="50"><span class="co">#&gt;  Melanogrammus aeglefinus:  6527   3rd Qu.:0.007100   3rd Qu.:3.243  </span></a>
<a class="sourceLine" id="cb2-51" data-line-number="51"><span class="co">#&gt;  Pleuronectes platessa   :  6403   Max.   :0.235000   Max.   :3.527  </span></a>
<a class="sourceLine" id="cb2-52" data-line-number="52"><span class="co">#&gt;  (Other)                 :113762                                     </span></a>
<a class="sourceLine" id="cb2-53" data-line-number="53"><span class="co">#&gt;     weight_g        CPUE_bio_per_hour  </span></a>
<a class="sourceLine" id="cb2-54" data-line-number="54"><span class="co">#&gt;  Min.   :    0.00   Min.   :     0.00  </span></a>
<a class="sourceLine" id="cb2-55" data-line-number="55"><span class="co">#&gt;  1st Qu.:    8.02   1st Qu.:     1.97  </span></a>
<a class="sourceLine" id="cb2-56" data-line-number="56"><span class="co">#&gt;  Median :   80.87   Median :    27.94  </span></a>
<a class="sourceLine" id="cb2-57" data-line-number="57"><span class="co">#&gt;  Mean   :  700.64   Mean   :   469.33  </span></a>
<a class="sourceLine" id="cb2-58" data-line-number="58"><span class="co">#&gt;  3rd Qu.:  439.08   3rd Qu.:   171.95  </span></a>
<a class="sourceLine" id="cb2-59" data-line-number="59"><span class="co">#&gt;  Max.   :35630.04   Max.   :310586.16  </span></a>
<a class="sourceLine" id="cb2-60" data-line-number="60"><span class="co">#&gt; </span></a></code></pre></div>
<p>Note that <code>LngtClas</code> is in mm, not cm, but that <code>a</code> and <code>b</code> are the length-weight coefficients for the length being in cm. Will use cm as units later.</p>
<p>Some columns are duplicated and we just want to keep the useful ones. <code>AphiaID</code> is a numerical code for each species. Need to know the number of areas, but don’t need to keep <code>Area</code>.</p>
<p><code>Survey</code> and <code>Quarter</code> are the same for all entries, and we don’t need to keep <code>Area</code>, just need the number of areas.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">numAreas =<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dataOrig<span class="op">$</span>Area))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">numAreas</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">colsKeep =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">             <span class="st">&quot;AphiaID&quot;</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">             <span class="st">&quot;LngtClas&quot;</span>,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">             <span class="st">&quot;CPUE_number_per_hour&quot;</span>,</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">             <span class="st">&quot;a&quot;</span>,</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">             <span class="st">&quot;b&quot;</span>,</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">             <span class="st">&quot;weight_g&quot;</span>,</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">             <span class="st">&quot;CPUE_bio_per_hour&quot;</span>)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">colsDiscard =<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">names</span>(dataOrig), colsKeep)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">colsDiscard</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; [1] &quot;Survey&quot;          &quot;Quarter&quot;         &quot;Area&quot;            &quot;Species&quot;        </span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; [5] &quot;Taxonomic.group&quot;</span></a></code></pre></div>
<p>Note that <code>data</code> will change a lot in the following code.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">data =<span class="st"> </span>sizeSpectra<span class="op">::</span><span class="kw">s_select</span>(dataOrig, colsKeep)   <span class="co"># uses Sebastian Kranz's s_dplyr_funcs.r</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">data</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; # A tibble: 178,435 x 8</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;     Year AphiaID LngtClas CPUE_number_per_hour      a     b weight_g</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;    &lt;int&gt;   &lt;int&gt;    &lt;int&gt;                &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;  1  2003  101170      360               0.0556 0.0033  2.70     52.4</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;  2  2008  101170        0               0      0.0033  2.70      0  </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  3  2004  101170        0               0      0.0033  2.70      0  </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  4  2004  101170      330               0.0244 0.0033  2.70     41.4</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  5  2013  101170      330               0.0909 0.0033  2.70     41.4</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  6  2013  101170        0               0      0.0033  2.70      0  </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  7  2003  101170        0               0      0.0033  2.70      0  </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  8  2012  101170      250               0.04   0.0033  2.70     19.6</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  9  1999  101170        0               0      0.0033  2.70      0  </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; 10  2003  101170      290               0.0972 0.0033  2.70     29.2</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; # ... with 178,425 more rows, and 1 more variable: CPUE_bio_per_hour &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co"># str(data)</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="kw">summary</span>(data)</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt;       Year         AphiaID          LngtClas      CPUE_number_per_hour</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt;  Min.   :1986   Min.   :101170   Min.   :   0.0   Min.   :   0.000    </span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt;  1st Qu.:1993   1st Qu.:126436   1st Qu.: 120.0   1st Qu.:   0.040    </span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt;  Median :2001   Median :126445   Median : 230.0   Median :   0.121    </span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt;  Mean   :2001   Mean   :125728   Mean   : 271.3   Mean   :  11.972    </span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt;  3rd Qu.:2008   3rd Qu.:127140   3rd Qu.: 370.0   3rd Qu.:   0.717    </span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt;  Max.   :2015   Max.   :274304   Max.   :1500.0   Max.   :7207.821    </span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt;        a                  b            weight_g        CPUE_bio_per_hour  </span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt;  Min.   :0.000100   Min.   :1.797   Min.   :    0.00   Min.   :     0.00  </span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt;  1st Qu.:0.003500   1st Qu.:3.079   1st Qu.:    8.02   1st Qu.:     1.97  </span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt;  Median :0.004200   Median :3.156   Median :   80.87   Median :    27.94  </span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt;  Mean   :0.006864   Mean   :3.146   Mean   :  700.64   Mean   :   469.33  </span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt;  3rd Qu.:0.007100   3rd Qu.:3.243   3rd Qu.:  439.08   3rd Qu.:   171.95  </span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt;  Max.   :0.235000   Max.   :3.527   Max.   :35630.04   Max.   :310586.16</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="kw">min</span>(data<span class="op">$</span>CPUE_number_per_hour)</a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
<p>So no negative CPUE values or spurious weights. There are a lot of zero CPUE values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">sum</span>(data<span class="op">$</span>CPUE_number_per_hour <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; [1] 22915</span></a></code></pre></div>
<p>Want to end up with <code>data</code> in a standard format (based on some original analysis I did when writing the code). Need to rename some of the headings, make the lengths in cm not mm, and (for helpfulness) order by <code>Year</code>, <code>SpecCode</code> and then <code>Lgnt</code>:</p>
<ol style="list-style-type: decimal">
<li>Rename the columns:</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="cf">if</span>(<span class="kw">sum</span>( colsKeep <span class="op">!=</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;AphiaID&quot;</span>, <span class="st">&quot;LngtClas&quot;</span>, <span class="st">&quot;CPUE_number_per_hour&quot;</span>,</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;weight_g&quot;</span>, <span class="st">&quot;CPUE_bio_per_hour&quot;</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">       { <span class="kw">stop</span>(<span class="st">&quot;Need to adjust renaming&quot;</span>) }</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw">names</span>(data) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;SpecCode&quot;</span>, <span class="st">&quot;LngtClass&quot;</span>, <span class="st">&quot;Number&quot;</span>, <span class="st">&quot;LWa&quot;</span>, <span class="st">&quot;LWb&quot;</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">         <span class="st">&quot;bodyMass&quot;</span>, <span class="st">&quot;CPUE_bio_per_hour&quot;</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co"># CPUE_bio_per_hour is Number * bodyMass</span></a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Make cm not mm:</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">data<span class="op">$</span>LngtClass =<span class="st"> </span>data<span class="op">$</span>LngtClass<span class="op">/</span><span class="dv">10</span></a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Rearrange the order to be more intuitive:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(data, Year, SpecCode, LngtClass)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">data</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; # A tibble: 178,435 x 8</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;     Year SpecCode LngtClass Number    LWa   LWb bodyMass CPUE_bio_per_hour</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;             &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;  1  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;  2  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;  3  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;  4  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  5  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  6  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  7  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  8  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  9  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; 10  1986   105814         0      0 0.0031  3.03        0                 0</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; # ... with 178,425 more rows</span></a></code></pre></div>
<p>That shows that we have a lot of (i) repeated values that can be amalgamated (presumably repeated because at one point the data included details about trawls, or it’s just how the data were obtained), (ii) lots of <code>Number == 0</code> that we can discard, though keep for now since will help verify the binning.</p>
<ol style="list-style-type: lower-roman">
<li>So, each row represents a combination of <code>Year, SpecCode, LngtClass</code>, but these aren’t unique. For example, looking at just one species for one year for one length class:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">exampleSp =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(data, Year <span class="op">==</span><span class="st"> </span><span class="dv">1986</span>, SpecCode <span class="op">==</span><span class="st"> </span><span class="dv">105814</span>, LngtClass <span class="op">==</span><span class="st"> </span><span class="dv">60</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">exampleSp</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; # A tibble: 2 x 8</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;    Year SpecCode LngtClass Number    LWa   LWb bodyMass CPUE_bio_per_hour</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt;   &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;             &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; 1  1986   105814        60 0.0833 0.0031  3.03     754.              62.8</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; 2  1986   105814        60 0.0833 0.0031  3.03     754.              62.8</span></a></code></pre></div>
<p>So, yes, we have multiple counts of 60cm fish of this species, which we can just aggregate together. Do this for all years, species and lengths:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(dplyr<span class="op">::</span><span class="kw">group_by</span>(data,</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">                                        Year,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                                        SpecCode,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                                        LngtClass),</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                        <span class="st">&quot;Number&quot;</span> =<span class="st"> </span><span class="kw">sum</span>(Number)<span class="op">/</span>numAreas,</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">                        <span class="st">&quot;LWa&quot;</span> =<span class="st"> </span><span class="kw">unique</span>(LWa),</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">                        <span class="st">&quot;LWb&quot;</span> =<span class="st"> </span><span class="kw">unique</span>(LWb),</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">                        <span class="st">&quot;bodyMass&quot;</span> =<span class="st"> </span><span class="kw">unique</span>(bodyMass))</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; `summarise()` has grouped output by 'Year', 'SpecCode'. You can override using the `.groups` argument.</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">data</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; # A tibble: 49,191 x 7</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; # Groups:   Year, SpecCode [2,550]</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;     Year SpecCode LngtClass  Number    LWa   LWb bodyMass</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;  1  1986   105814         0 0       0.0031  3.03     0   </span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt;  2  1986   105814        10 0.0571  0.0031  3.03     3.31</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt;  3  1986   105814        45 0.00714 0.0031  3.03   315.  </span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt;  4  1986   105814        46 0.00714 0.0031  3.03   337.  </span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt;  5  1986   105814        50 0.00714 0.0031  3.03   434.  </span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt;  6  1986   105814        52 0.0293  0.0031  3.03   489.  </span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt;  7  1986   105814        53 0.0109  0.0031  3.03   518.  </span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="co">#&gt;  8  1986   105814        54 0.0113  0.0031  3.03   548.  </span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#&gt;  9  1986   105814        56 0.0218  0.0031  3.03   612.  </span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co">#&gt; 10  1986   105814        57 0.0188  0.0031  3.03   646.  </span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co">#&gt; # ... with 49,181 more rows</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="kw">summary</span>(data)</a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#&gt;       Year         SpecCode        LngtClass          Number         </span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="co">#&gt;  Min.   :1986   Min.   :101170   Min.   :  0.00   Min.   :   0.0000  </span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="co">#&gt;  1st Qu.:1993   1st Qu.:126426   1st Qu.: 14.00   1st Qu.:   0.0087  </span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co">#&gt;  Median :2001   Median :126461   Median : 27.00   Median :   0.0347  </span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="co">#&gt;  Mean   :2001   Mean   :124528   Mean   : 32.48   Mean   :   6.2037  </span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="co">#&gt;  3rd Qu.:2008   3rd Qu.:127140   3rd Qu.: 45.00   3rd Qu.:   0.2604  </span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="co">#&gt;  Max.   :2015   Max.   :274304   Max.   :150.00   Max.   :1591.4413  </span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="co">#&gt;       LWa                LWb           bodyMass       </span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="co">#&gt;  Min.   :0.000100   Min.   :1.797   Min.   :    0.00  </span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="co">#&gt;  1st Qu.:0.003400   1st Qu.:3.054   1st Qu.:   17.05  </span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="co">#&gt;  Median :0.004200   Median :3.147   Median :  152.50  </span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="co">#&gt;  Mean   :0.008107   Mean   :3.129   Mean   :  918.59  </span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="co">#&gt;  3rd Qu.:0.007800   3rd Qu.:3.243   3rd Qu.:  718.34  </span></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="co">#&gt;  Max.   :0.235000   Max.   :3.527   Max.   :35630.04</span></a>
<a class="sourceLine" id="cb10-41" data-line-number="41"></a>
<a class="sourceLine" id="cb10-42" data-line-number="42">dplyr<span class="op">::</span><span class="kw">filter</span>(data, SpecCode <span class="op">==</span><span class="st"> </span><span class="dv">105814</span>, Year <span class="op">==</span><span class="st"> </span><span class="dv">1986</span>, LngtClass <span class="op">==</span><span class="st"> </span><span class="dv">60</span>)</a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="co">#&gt; # A tibble: 1 x 7</span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="co">#&gt; # Groups:   Year, SpecCode [1]</span></a>
<a class="sourceLine" id="cb10-45" data-line-number="45"><span class="co">#&gt;    Year SpecCode LngtClass Number    LWa   LWb bodyMass</span></a>
<a class="sourceLine" id="cb10-46" data-line-number="46"><span class="co">#&gt;   &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb10-47" data-line-number="47"><span class="co">#&gt; 1  1986   105814        60 0.0238 0.0031  3.03     754.</span></a></code></pre></div>
<p>So <code>Number</code> here correctly equals the sum of the first two rows of <code>exampleSp</code> divided by seven (areas).</p>
<p><code>Number</code> is the average number (of each species and length) caught per hour of trawling across all seven areas.</p>
<p>Just confirm the calculations for <code>bodyMass</code> (body mass of an individual of that <code>LngtClass</code>) since they were done during preprocessing; should get the same answer, using species-specific length-weight coversions.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(data,</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">                     <span class="dt">bodyMass2 =</span> LWa <span class="op">*</span><span class="st"> </span>LngtClass<span class="op">^</span>LWb)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="cf">if</span>(<span class="kw">max</span>(<span class="kw">abs</span>(data<span class="op">$</span>bodyMass2 <span class="op">-</span><span class="st"> </span>data<span class="op">$</span>bodyMass)) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0001</span>) <span class="kw">stop</span>(<span class="st">&quot;Check conversions&quot;</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(data, <span class="op">-</span>bodyMass2)              <span class="co"># don't keep the confirming column</span></a></code></pre></div>
<p>Now only include body-mass classes above 4 g, following Blanchard et al. (2005), since data are unreliable for smaller organisms:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">range</span>(data<span class="op">$</span>LngtClass)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt; [1]   0 150</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">range</span>(data<span class="op">$</span>bodyMass)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; [1]     0.00 35630.04</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw">sum</span>(data<span class="op">$</span>bodyMass <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)   <span class="co"># 2549</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; [1] 2549</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="kw">sum</span>(data<span class="op">$</span>bodyMass <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span> )   <span class="co"># 6893</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; [1] 6893</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9">data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(data, bodyMass <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="kw">range</span>(data<span class="op">$</span>bodyMass)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; [1]     4.045665 35630.037377</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12">data</a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt; # A tibble: 42,298 x 7</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt; # Groups:   Year, SpecCode [2,182]</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt;     Year SpecCode LngtClass  Number    LWa   LWb bodyMass</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt;  1  1986   105814        45 0.00714 0.0031  3.03     315.</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt;  2  1986   105814        46 0.00714 0.0031  3.03     337.</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt;  3  1986   105814        50 0.00714 0.0031  3.03     434.</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt;  4  1986   105814        52 0.0293  0.0031  3.03     489.</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt;  5  1986   105814        53 0.0109  0.0031  3.03     518.</span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="co">#&gt;  6  1986   105814        54 0.0113  0.0031  3.03     548.</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co">#&gt;  7  1986   105814        56 0.0218  0.0031  3.03     612.</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="co">#&gt;  8  1986   105814        57 0.0188  0.0031  3.03     646.</span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="co">#&gt;  9  1986   105814        58 0.0381  0.0031  3.03     680.</span></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="co">#&gt; 10  1986   105814        59 0.0327  0.0031  3.03     717.</span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="co">#&gt; # ... with 42,288 more rows</span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="kw">summary</span>(data)</a>
<a class="sourceLine" id="cb12-29" data-line-number="29"><span class="co">#&gt;       Year         SpecCode        LngtClass          Number         </span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30"><span class="co">#&gt;  Min.   :1986   Min.   :101170   Min.   :  4.00   Min.   :   0.0003  </span></a>
<a class="sourceLine" id="cb12-31" data-line-number="31"><span class="co">#&gt;  1st Qu.:1993   1st Qu.:126436   1st Qu.: 19.00   1st Qu.:   0.0110  </span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32"><span class="co">#&gt;  Median :2001   Median :126450   Median : 31.00   Median :   0.0387  </span></a>
<a class="sourceLine" id="cb12-33" data-line-number="33"><span class="co">#&gt;  Mean   :2001   Mean   :124117   Mean   : 36.99   Mean   :   5.1455  </span></a>
<a class="sourceLine" id="cb12-34" data-line-number="34"><span class="co">#&gt;  3rd Qu.:2008   3rd Qu.:127140   3rd Qu.: 49.00   3rd Qu.:   0.2657  </span></a>
<a class="sourceLine" id="cb12-35" data-line-number="35"><span class="co">#&gt;  Max.   :2015   Max.   :274304   Max.   :150.00   Max.   :1591.4413  </span></a>
<a class="sourceLine" id="cb12-36" data-line-number="36"><span class="co">#&gt;       LWa                LWb           bodyMass       </span></a>
<a class="sourceLine" id="cb12-37" data-line-number="37"><span class="co">#&gt;  Min.   :0.000100   Min.   :1.797   Min.   :    4.05  </span></a>
<a class="sourceLine" id="cb12-38" data-line-number="38"><span class="co">#&gt;  1st Qu.:0.003400   1st Qu.:3.054   1st Qu.:   45.96  </span></a>
<a class="sourceLine" id="cb12-39" data-line-number="39"><span class="co">#&gt;  Median :0.004200   Median :3.156   Median :  246.19  </span></a>
<a class="sourceLine" id="cb12-40" data-line-number="40"><span class="co">#&gt;  Mean   :0.008035   Mean   :3.131   Mean   : 1068.13  </span></a>
<a class="sourceLine" id="cb12-41" data-line-number="41"><span class="co">#&gt;  3rd Qu.:0.007800   3rd Qu.:3.243   3rd Qu.:  904.47  </span></a>
<a class="sourceLine" id="cb12-42" data-line-number="42"><span class="co">#&gt;  Max.   :0.235000   Max.   :3.527   Max.   :35630.04</span></a></code></pre></div>
<p>Total number of fish in this dataset is</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">sum</span>(data<span class="op">$</span>Number)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#&gt; [1] 217645.3</span></a></code></pre></div>
<p>The unique length classes are:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">sort</span>(<span class="kw">unique</span>(data<span class="op">$</span>LngtClass))</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co">#&gt;   [1]   4.0   5.0   6.0   7.0   8.0   9.0  10.0  10.5  11.0  11.5  12.0  12.5</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt;  [13]  13.0  13.5  14.0  14.5  15.0  15.5  16.0  16.5  17.0  17.5  18.0  18.5</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt;  [25]  19.0  19.5  20.0  20.5  21.0  21.5  22.0  22.5  23.0  23.5  24.0  24.5</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt;  [37]  25.0  25.5  26.0  26.5  27.0  27.5  28.0  28.5  29.0  29.5  30.0  30.5</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt;  [49]  31.0  31.5  32.0  32.5  33.0  33.5  34.0  34.5  35.0  35.5  36.0  36.5</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt;  [61]  37.0  38.0  39.0  40.0  41.0  42.0  43.0  44.0  45.0  46.0  47.0  48.0</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt;  [73]  49.0  50.0  51.0  52.0  53.0  54.0  55.0  56.0  57.0  58.0  59.0  60.0</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt;  [85]  61.0  62.0  63.0  64.0  65.0  66.0  67.0  68.0  69.0  70.0  71.0  72.0</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt;  [97]  73.0  74.0  75.0  76.0  77.0  78.0  79.0  80.0  81.0  82.0  83.0  84.0</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; [109]  85.0  86.0  87.0  88.0  89.0  90.0  91.0  92.0  93.0  94.0  95.0  96.0</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; [121]  97.0  98.0  99.0 100.0 101.0 102.0 103.0 104.0 105.0 106.0 107.0 108.0</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; [133] 109.0 110.0 111.0 112.0 113.0 114.0 115.0 116.0 117.0 118.0 119.0 120.0</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; [145] 121.0 122.0 123.0 124.0 125.0 126.0 127.0 128.0 129.0 130.0 131.0 132.0</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; [157] 133.0 134.0 135.0 138.0 139.0 140.0 142.0 144.0 145.0 146.0 149.0 150.0</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="kw">diff</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(data<span class="op">$</span>LngtClass)))</a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt;   [1] 1.0 1.0 1.0 1.0 1.0 1.0 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt;  [19] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt;  [37] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt;  [55] 0.5 0.5 0.5 0.5 0.5 0.5 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt;  [73] 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt;  [91] 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt; [109] 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co">#&gt; [127] 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">#&gt; [145] 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 3.0 1.0 1.0 2.0</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">#&gt; [163] 2.0 1.0 1.0 3.0 1.0</span></a></code></pre></div>
<p>The 0.5-cm length classes are only for two species, Atlantic Herring (code 126417) and European Sprat (code 126425), as confirmed here (no differences of 0.5cm):</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">temp =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(data, <span class="op">!</span>(SpecCode <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">126417</span>, <span class="dv">126425</span>)))</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">unique</span>(<span class="kw">diff</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(temp<span class="op">$</span>LngtClass))))</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; [1] 1 3 2</span></a></code></pre></div>
<p>Aside – species names and codes are in <code>specCodeNames</code> (though it needs updating as more species in the data than listed here):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">specCodeNames</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#&gt; # A tibble: 111 x 2</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt;    species             speccode</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt;    &lt;fct&gt;                  &lt;int&gt;</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt;  1 Agonus cataphractus   127190</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt;  2 Alosa alosa           126413</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt;  3 Alosa fallax          126415</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt;  4 Amblyraja radiata     105865</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt;  5 Ammodytes marinus     126751</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt;  6 Ammodytidae           125516</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt;  7 Anarhichas lupus      126758</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt;  8 Argentina silus       126715</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt;  9 Argentina sphyraena   126716</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt; 10 Arnoglossus           126109</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; # ... with 101 more rows</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="kw">length</span>(<span class="kw">unique</span>(specCodeNames<span class="op">$</span>speccode))   <span class="co"># checking speccode are unique</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; [1] 111</span></a></code></pre></div>
<p>Need this to stop earlier groups being kept (can mess up later code):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">ungroup</span>(data)</a></code></pre></div>
<p>These next commands here (which are not run in this vignette) are to save <code>IBTS_data</code> in the package (which has already been run once to build the package). Rename and save <code>data</code> with a meaningful name for your own data.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">IBTS_data =<span class="st"> </span>data</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">usethis<span class="op">::</span><span class="kw">use_data</span>(IBTS_data, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<!--  save(data, file="nSeaFungImport.RData")-->
<p>So we have the following, where each row is a unique combination of <code>Year</code>, <code>SpecCode</code> and <code>LngtClass</code> (cm, the minimum value of the 1-cm length bin [or 0.5-cm bin for Atlantic Herring and European Sprat]), and <code>Number</code> gives the number of individuals per hour of trawling observed for the combination. Parameters <code>LWa</code> and <code>LWb</code> are the length-weight cofficients for that species from Fung et al. (2012), <code>bodyMass</code> (g) is the resulting estimated body mass for an individual of that species and length class and <code>Biomass</code> (g h<sup>-1</sup>) is calculated here as the total biomass caught per hour of trawling for each row.</p>
<p>The resulting Table 1 is:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">data_biomass &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(data,</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">                              <span class="dt">Biomass =</span> Number <span class="op">*</span><span class="st"> </span>bodyMass)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">rbind</span>(data_biomass[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,],</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">                   data_biomass[(<span class="kw">nrow</span>(data_biomass)<span class="op">-</span><span class="dv">5</span>)<span class="op">:</span><span class="kw">nrow</span>(data_biomass),</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">                                     ]),</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">             <span class="dt">digits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">SpecCode</th>
<th align="right">LngtClass</th>
<th align="right">Number</th>
<th align="right">LWa</th>
<th align="right">LWb</th>
<th align="right">bodyMass</th>
<th align="right">Biomass</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1986</td>
<td align="right">105814</td>
<td align="right">45</td>
<td align="right">0.007</td>
<td align="right">0.0031</td>
<td align="right">3.0290</td>
<td align="right">315.46</td>
<td align="right">2.25</td>
</tr>
<tr class="even">
<td align="right">1986</td>
<td align="right">105814</td>
<td align="right">46</td>
<td align="right">0.007</td>
<td align="right">0.0031</td>
<td align="right">3.0290</td>
<td align="right">337.17</td>
<td align="right">2.41</td>
</tr>
<tr class="odd">
<td align="right">1986</td>
<td align="right">105814</td>
<td align="right">50</td>
<td align="right">0.007</td>
<td align="right">0.0031</td>
<td align="right">3.0290</td>
<td align="right">434.05</td>
<td align="right">3.10</td>
</tr>
<tr class="even">
<td align="right">1986</td>
<td align="right">105814</td>
<td align="right">52</td>
<td align="right">0.029</td>
<td align="right">0.0031</td>
<td align="right">3.0290</td>
<td align="right">488.81</td>
<td align="right">14.33</td>
</tr>
<tr class="odd">
<td align="right">1986</td>
<td align="right">105814</td>
<td align="right">53</td>
<td align="right">0.011</td>
<td align="right">0.0031</td>
<td align="right">3.0290</td>
<td align="right">517.84</td>
<td align="right">5.65</td>
</tr>
<tr class="even">
<td align="right">1986</td>
<td align="right">105814</td>
<td align="right">54</td>
<td align="right">0.011</td>
<td align="right">0.0031</td>
<td align="right">3.0290</td>
<td align="right">548.00</td>
<td align="right">6.18</td>
</tr>
<tr class="odd">
<td align="right">2015</td>
<td align="right">154675</td>
<td align="right">34</td>
<td align="right">0.028</td>
<td align="right">0.0244</td>
<td align="right">2.0439</td>
<td align="right">32.93</td>
<td align="right">0.92</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="right">274304</td>
<td align="right">8</td>
<td align="right">0.013</td>
<td align="right">0.0080</td>
<td align="right">3.1410</td>
<td align="right">5.49</td>
<td align="right">0.07</td>
</tr>
<tr class="odd">
<td align="right">2015</td>
<td align="right">274304</td>
<td align="right">14</td>
<td align="right">0.039</td>
<td align="right">0.0080</td>
<td align="right">3.1410</td>
<td align="right">31.85</td>
<td align="right">1.24</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="right">274304</td>
<td align="right">15</td>
<td align="right">0.052</td>
<td align="right">0.0080</td>
<td align="right">3.1410</td>
<td align="right">39.55</td>
<td align="right">2.05</td>
</tr>
<tr class="odd">
<td align="right">2015</td>
<td align="right">274304</td>
<td align="right">16</td>
<td align="right">0.065</td>
<td align="right">0.0080</td>
<td align="right">3.1410</td>
<td align="right">48.44</td>
<td align="right">3.15</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="right">274304</td>
<td align="right">17</td>
<td align="right">0.013</td>
<td align="right">0.0080</td>
<td align="right">3.1410</td>
<td align="right">58.60</td>
<td align="right">0.76</td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
